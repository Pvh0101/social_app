# Mô hình hóa hệ thống Social App

## 1. Kiến trúc tổng thể

### 1.1. Kiến trúc ứng dụng
Ứng dụng Social App được xây dựng theo mô hình kiến trúc phân lớp kết hợp với kiến trúc hướng tính năng (feature-based architecture):

```
┌─────────────────────────────────────────────────────────────┐
│                      Presentation Layer                      │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐ │
│  │  Screens │  │ Widgets │  │  Pages  │  │ UI Components   │ │
│  └─────────┘  └─────────┘  └─────────┘  └─────────────────┘ │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                      Application Layer                       │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐ │
│  │ Providers│  │Notifiers│  │ Services│  │ State Management│ │
│  └─────────┘  └─────────┘  └─────────┘  └─────────────────┘ │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                       Domain Layer                           │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐ │
│  │  Models  │  │ Entities│  │Use Cases│  │Business Logic   │ │
│  └─────────┘  └─────────┘  └─────────┘  └─────────────────┘ │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                        Data Layer                            │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐ │
│  │Repositories│ │Data Sources│ │ APIs │  │ Local Storage   │ │
│  └─────────┘  └─────────┘  └─────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 1.2. Kiến trúc hệ thống
Hệ thống Social App được xây dựng theo mô hình client-server với Firebase làm backend:

```
┌─────────────────┐     ┌───────────────────────────────────┐
│                 │     │            Firebase               │
│                 │     │  ┌─────────┐    ┌─────────────┐   │
│                 │     │  │Firebase │    │Firebase     │   │
│  Mobile Client  │◄────┼─►│Firestore│    │Authentication│  │
│  (Flutter App)  │     │  └─────────┘    └─────────────┘   │
│                 │     │  ┌─────────┐    ┌─────────────┐   │
│                 │     │  │Firebase │    │Firebase     │   │
│                 │     │  │Storage  │    │Cloud Messaging│ │
└─────────────────┘     │  └─────────┘    └─────────────┘   │
                        └───────────────────────────────────┘
```

## 2. Mô hình dữ liệu

### 2.1. Mô hình thực thể quan hệ (ERD)
Xem chi tiết trong file `erd_diagram.md`

### 2.2. Cấu trúc Firestore Collections

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    users    │     │    posts    │     │  comments   │
└─────────────┘     └─────────────┘     └─────────────┘
      │                   │                   │
      │                   │                   │
      ▼                   ▼                   ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    likes    │     │   stories   │     │ story_views │
└─────────────┘     └─────────────┘     └─────────────┘
      │                   │                   │
      │                   │                   │
      ▼                   ▼                   ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    chats    │     │chat_members │     │  messages   │
└─────────────┘     └─────────────┘     └─────────────┘
      │                   │                   │
      │                   │                   │
      ▼                   ▼                   ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ friendships │     │   follows   │     │notifications │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
                                              │
                                              ▼
                                        ┌─────────────┐
                                        │user_settings│
                                        └─────────────┘
```

## 3. Mô hình lớp (Class Diagram)

### 3.1. Lớp Model

```
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│   UserModel   │     │   PostModel   │     │ CommentModel  │
├───────────────┤     ├───────────────┤     ├───────────────┤
│ - uid         │     │ - postId      │     │ - commentId   │
│ - email       │     │ - userId      │     │ - postId      │
│ - fullName    │     │ - content     │     │ - userId      │
│ - gender      │     │ - fileUrls    │     │ - parentId    │
│ - birthDay    │     │ - thumbnailUrl│     │ - content     │
│ - phoneNumber │     │ - postType    │     │ - createdAt   │
│ - address     │     │ - createdAt   │     │ - updatedAt   │
│ - profileImage│     │ - updatedAt   │     │ - likeCount   │
│ - decs        │     │ - likeCount   │     │ + fromMap()   │
│ - lastSeen    │     │ - commentCount│     │ + toMap()     │
│ - createdAt   │     ├───────────────┤     │ + likePost()  │
│ - isOnline    │     │ + fromMap()   │     │ + unlikePost() │
│ - isPrivate   │     │ + toMap()     │     │ + getComments()│
│ - token       │     └───────────────┘     │ + getViewers() │
│ - followersCount│
├───────────────┤
│ + fromMap()   │
│ + toMap()     │
│ + copyWith()  │
└───────────────┘
```

### 3.2. Lớp Repository

```
┌───────────────────┐     ┌───────────────────┐
│  UserRepository   │     │  PostRepository   │
├───────────────────┤     ├───────────────────┤
│ - firestore       │     │ - firestore       │
│ - auth            │     │ - storage         │
├───────────────────┤     ├───────────────────┤
│ + getUser()       │     │ + getPosts()      │
│ + updateUser()    │     │ + createPost()    │
│ + deleteUser()    │     │ + updatePost()    │
│ + signIn()        │     │ + deletePost()    │
│ + signUp()        │     │ + likePost()      │
│ + signOut()       │     │ + unlikePost()    │
│ + resetPassword() │     │ + getComments()   │
└───────────────────┘     └───────────────────┘

┌───────────────────┐     ┌───────────────────┐
│  ChatRepository   │     │ StoryRepository   │
├───────────────────┤     ├───────────────────┤
│ - firestore       │     │ - firestore       │
│ - storage         │     │ - storage         │
├───────────────────┤     ├───────────────────┤
│ + getChats()      │     │ + getStories()    │
│ + createChat()    │     │ + createStory()   │
│ + sendMessage()   │     │ + deleteStory()   │
│ + getMessages()   │     │ + viewStory()     │
│ + deleteMessage() │     │ + getViewers()    │
└───────────────────┘     └───────────────────┘
```

### 3.3. Lớp Provider/Notifier

```
┌───────────────────┐     ┌───────────────────┐
│   AuthProvider    │     │   PostProvider    │
├───────────────────┤     ├───────────────────┤
│ - userRepository  │     │ - postRepository  │
├───────────────────┤     ├───────────────────┤
│ + currentUser     │     │ + posts           │
│ + isLoggedIn      │     │ + isLoading       │
│ + signIn()        │     │ + fetchPosts()    │
│ + signUp()        │     │ + createPost()    │
│ + signOut()       │     │ + updatePost()    │
│ + resetPassword() │     │ + deletePost()    │
└───────────────────┘     │ + likePost()      │
                          │ + unlikePost()    │
                          └───────────────────┘
```

## 4. Mô hình luồng dữ liệu

### 4.1. Luồng xác thực người dùng

```
┌──────────┐     ┌──────────┐     ┌──────────────┐     ┌──────────┐
│  UI/View │     │ Provider │     │  Repository  │     │ Firebase │
└────┬─────┘     └────┬─────┘     └──────┬───────┘     └────┬─────┘
     │                │                   │                  │
     │ signIn(email,  │                   │                  │
     │ password)      │                   │                  │
     │───────────────>│                   │                  │
     │                │ signIn(email,     │                  │
     │                │ password)         │                  │
     │                │──────────────────>│                  │
     │                │                   │ signInWithEmail  │
     │                │                   │AndPassword()     │
     │                │                   │─────────────────>│
     │                │                   │                  │
     │                │                   │      result      │
     │                │                   │<─────────────────│
     │                │     result        │                  │
     │                │<──────────────────│                  │
     │    result      │                   │                  │
     │<───────────────│                   │                  │
     │                │                   │                  │
```

### 4.2. Luồng tạo bài viết

```
┌──────────┐     ┌──────────┐     ┌──────────────┐     ┌──────────┐
│  UI/View │     │ Provider │     │  Repository  │     │ Firebase │
└────┬─────┘     └────┬─────┘     └──────┬───────┘     └────┬─────┘
     │                │                   │                  │
     │ createPost(    │                   │                  │
     │ content, files)│                   │                  │
     │───────────────>│                   │                  │
     │                │ createPost(       │                  │
     │                │ content, files)   │                  │
     │                │──────────────────>│                  │
     │                │                   │ uploadFiles()    │
     │                │                   │─────────────────>│
     │                │                   │                  │
     │                │                   │   fileUrls       │
     │                │                   │<─────────────────│
     │                │                   │                  │
     │                │                   │ createPost()     │
     │                │                   │─────────────────>│
     │                │                   │                  │
     │                │                   │   postId         │
     │                │                   │<─────────────────│
     │                │     result        │                  │
     │                │<──────────────────│                  │
     │    result      │                   │                  │
     │<───────────────│                   │                  │
     │                │                   │                  │
```

## 5. Mô hình triển khai (Deployment Diagram)

```
┌─────────────────────────────────────────────────────────────┐
│                      User Device                             │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   Flutter App                        │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │ UI Layer    │  │ Logic Layer │  │ Data Layer  │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────┬───────────────────────────────┘
                              │
                              │ HTTPS
                              │
┌─────────────────────────────▼───────────────────────────────┐
│                      Firebase Cloud                          │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ Firebase    │  │ Firebase    │  │ Firebase            │ │
│  │ Auth        │  │ Firestore   │  │ Storage             │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ Firebase    │  │ Firebase    │  │ Firebase            │ │
│  │ Functions   │  │ Hosting     │  │ Cloud Messaging     │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 6. Mô hình thành phần (Component Diagram)

```
┌───────────────────────────────────────────────────────────┐
│                      Flutter App                           │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ UI Components│◄─────►│ Providers   │                    │
│  └─────────────┘       └──────┬──────┘                    │
│                               │                           │
│                               │                           │
│  ┌─────────────┐       ┌──────▼──────┐                    │
│  │ Models      │◄─────►│ Repositories│                    │
│  └─────────────┘       └──────┬──────┘                    │
│                               │                           │
│                               │                           │
│  ┌─────────────┐       ┌──────▼──────┐    ┌─────────────┐ │
│  │ Utils       │◄─────►│ Services    │◄──►│ Firebase SDK│ │
│  └─────────────┘       └─────────────┘    └─────────────┘ │
│                                                           │
└───────────────────────────────────────────────────────────┘
                                  │
                                  │
                                  ▼
┌───────────────────────────────────────────────────────────┐
│                      Firebase Backend                      │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐    ┌─────────────┐ │
│  │ Authentication│     │ Firestore   │    │ Storage     │ │
│  └─────────────┘       └─────────────┘    └─────────────┘ │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐    ┌─────────────┐ │
│  │ Functions   │       │ Hosting     │    │ Messaging   │ │
│  └─────────────┘       └─────────────┘    └─────────────┘ │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

## 7. Mô hình trạng thái (State Diagram)

### 7.1. Trạng thái bài viết

```
                    ┌───────────┐
                    │  Created  │
                    └─────┬─────┘
                          │
                          ▼
┌───────────┐      ┌───────────┐      ┌───────────┐
│  Deleted  │◄─────┤ Published │─────►│  Edited   │
└───────────┘      └─────┬─────┘      └───────────┘
                          │
                          ▼
                    ┌───────────┐
                    │ Reported  │
                    └───────────┘
```

### 7.2. Trạng thái người dùng

```
┌───────────┐      ┌───────────┐      ┌───────────┐
│ Anonymous │─────►│ Registered│─────►│ Verified  │
└───────────┘      └───────────┘      └─────┬─────┘
                                            │
                                            ▼
                    ┌───────────┐      ┌───────────┐
                    │ Suspended │◄─────┤  Active   │
                    └───────────┘      └─────┬─────┘
                                            │
                                            ▼
                                      ┌───────────┐
                                      │  Offline  │
                                      └───────────┘
```

## 8. Mô hình hoạt động (Activity Diagram)

Xem chi tiết trong file `activity_diagrams.md`

## 9. Mô hình trường hợp sử dụng (Use Case Diagram)

### 9.1. Trường hợp sử dụng chính

```
┌───────────────────────────────────────────────────────────┐
│                      Social App                            │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Đăng ký     │       │ Đăng nhập   │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Xem feed    │       │ Đăng bài    │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Thích/Bình  │       │ Nhắn tin    │                    │
│  │ luận        │       │             │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Kết bạn     │       │ Theo dõi    │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Đăng story  │       │ Xem story   │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Cài đặt     │       │ Tìm kiếm    │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

## 10. Mô hình giao diện người dùng (UI Model)

### 10.1. Cấu trúc màn hình

```
┌───────────────────────────────────────────────────────────┐
│                      Social App                            │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Splash      │───────┤ Onboarding  │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Login       │───────┤ Register    │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐                                          │
│  │ Home        │                                          │
│  │ ┌─────────┐ │       ┌─────────────┐                    │
│  │ │ Feed    │ │───────┤ Post Detail │                    │
│  │ └─────────┘ │       └─────────────┘                    │
│  │ ┌─────────┐ │                                          │
│  │ │ Video   │ │       ┌─────────────┐                    │
│  │ └─────────┘ │───────┤ Create Post │                    │
│  │ ┌─────────┐ │       └─────────────┘                    │
│  │ │ Friends │ │                                          │
│  │ └─────────┘ │       ┌─────────────┐                    │
│  │ ┌─────────┐ │───────┤ Profile     │                    │
│  │ │ Notif   │ │       └─────────────┘                    │
│  │ └─────────┘ │                                          │
│  │ ┌─────────┐ │       ┌─────────────┐                    │
│  │ │ Menu    │ │───────┤ Settings    │                    │
│  │ └─────────┘ │       └─────────────┘                    │
│  └─────────────┘                                          │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Chat List   │───────┤ Chat Screen │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

## 11. Mô hình bảo mật

### 11.1. Cấu trúc bảo mật

```
┌───────────────────────────────────────────────────────────┐
│                      Security Model                        │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Firebase    │       │ Firestore   │                    │
│  │ Auth        │       │ Rules       │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Storage     │       │ Cloud       │                    │
│  │ Rules       │       │ Functions   │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Client-side │       │ Server-side │                    │
│  │ Validation  │       │ Validation  │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

## 12. Mô hình hiệu suất

### 12.1. Chiến lược tối ưu hiệu suất

```
┌───────────────────────────────────────────────────────────┐
│                   Performance Optimization                 │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Lazy Loading│       │ Pagination  │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Image       │       │ Video       │                    │
│  │ Caching     │       │ Optimization│                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
│  ┌─────────────┐       ┌─────────────┐                    │
│  │ Firestore   │       │ Offline     │                    │
│  │ Indexing    │       │ Support     │                    │
│  └─────────────┘       └─────────────┘                    │
│                                                           │
└───────────────────────────────────────────────────────────┘
``` 